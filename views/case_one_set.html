{{template "head.html" .}}

<div style="padding-top: 50px; padding-left: 200px; padding-right: 300px; display: inline-block;float: left" >
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px; float: left">
        <legend>源case筛选</legend>
    </fieldset>
</div>

<div style="padding-top: 50px; padding-left: 300px; padding-right: 300px;display: inline-block">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 1px; float: right">
        <legend>你所添加的case</legend>
    </fieldset>
</div>

<form class="layui-form" action="" id="test_service" style="display: none">
    <div class="layui-form-item" id="test_service_list">
        <!--        <div class="layui-input-inline"><input type="checkbox" name="" title="写作" checked></div>-->
    </div>
</form>

<div style="margin:1%">
    <div>
        <div class="layui-form layui-inline">
{{/*            <div class="layui-inline">*/}}
{{/*                <select name="" id="search_service">*/}}
{{/*                    <option value="">请选择</option>*/}}
{{/*                </select>*/}}

{{/*            </div>*/}}
            <div class="layui-inline">
                <input type="text" class="case_name layui-input" placeholder="请输case名称">
            </div>
            <div class="layui-inline">
                <button class="layui-btn layui-btn-sm " style="display: inline" id="search_btn">搜索</button>
            </div>
        </div>
    </div>
    <div style="float: left">
    <table class="layui-table" lay-filter="demo" id="idTest" ></table>
    </div>
    <div style="float: left;margin-left: 200px" >
        <table class="layui-table" lay-filter="demo2" id="idTest2"></table>
    </div>



    <script type="text/html" id="barDemo">
        <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="copy">添加case至当前case集合</a>
    </script>

    <script type="text/html" id="barDemo2">
{{/*        */}}{{/*        <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="run">运行</a>*/}}
{{/*        */}}{{/*        <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="edit">编辑</a>*/}}
{{/*        <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="copy">添加case至当前case集合</a>*/}}
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>

    <script src="/static/layui/layui.js" charset="utf-8"></script>
    <script src="/static/js/public.js" charset="utf-8"></script>
    <script>

        layui.use(['table','laytpl','form'], function(){
            const table = layui.table;
            var form = layui.form;
            $ = layui.jquery
            // 获取service的方法
            $(function () {
                $.ajax({
                    type: 'GET',
                    url: '/service/list?business={{.business}}',
                    success: function (data) {
                        var date = data.data
                        var html = ""
                        $.each(date, function (n, val) {
                            const option1 = '<div class="layui-input-inline">' +
                                '<input type="checkbox" name="service" value='+val["id"]+' title='+val["service_name"]+'></div>';
                            html = html + option1
                            $("#search_service").append('<option value='+val["service_name"]+'>'+val["service_name"]+'</option>');
                        })
                        $("#test_service_list").append(html);
                        form.render();
                    }
                })
            })

            //表格渲染
            table.render({
                elem:'#idTest'
                ,url:'/case/get_all_cases?business={{.business}}'
                ,page:true
                ,width :750
                ,height :500
                ,cols:[[
                    {title: 'ID', field:'id', width:80, sort: true, fixed: true},
                    {title: '业务线', field:'business_name', width:100},
                    {title: '服务名称', field:'service_name', width:150},
                    {title: '用例名称', field:'case_name', width:200},
                    {title: '操作', fixed:"right",toolbar:'#barDemo', width:180},
                ]]
            })

            //监听工具条
            table.on('tool(demo)', function(obj){
                var data = obj.data;
                if(obj.event === 'detail'){
                    layer.msg('ID：'+ data.id + ' 的查看操作');
                }else if(obj.event === 'copy'){
                    window.location.href="/case/show_copy_case_set?id="+data.id+"&business={{.business}}"+"&case_set_id="+{{.id}}
                    {{/*// window.open("/case/show_copy_case?id="+data.id+"&business={{.business}}","_blank");*/}}
                }
                layui.close(obj);
            });

            $(document).on("click",".add_case", function (){
                window.location.href= "/case/show_add_case"
            });



            $(document).on("click", "#search_btn", function (){
                let case_name = $(".case_name").val();
                // let service = $("#search_service option:selected").val()
                if(case_name === undefined){case_name = ""}
                // if(service === undefined){service = ""}
                table.render({
                    elem:'#idTest'
                    ,url:'/case/get_case_by_condition?business_code={{.business}}&case_name='+case_name
                    ,page:true
                    ,width :750
                    ,height :500
                    ,cols:[[
                        {title: 'ID', field:'id', width:80, sort: true, fixed: true},
                        {title: '业务线', field:'business_name', width:100},
                        {title: '服务名称', field:'service_name', width:150},
                        {title: '用例名称', field:'case_name', width:200},
                        {title: '操作', fixed:"right",toolbar:'#barDemo', width:180},
                    ]]
                })
            });

            //一条caseset所对应的case
            table.render({
                elem:'#idTest2'
                ,url:'/case_set/get_set_case_list_by_case_set_id?business={{.business}}'+"&case_set_id="+{{.id}} //接口未定
                ,page:false
                ,width :600
                ,height :500
                ,cols:[[
                    {title: 'ID', field:'id', width:80, sort: true, fixed: true},
                    {title: '业务线', field:'business_name', width:100},
                    {title: '服务名称', field:'service_name', width:150},
                    {title: '用例名称', field:'case_name', width:200},
                    {title: '操作', fixed:"right",toolbar:'#barDemo2', width:80},
                ]]
            })
            table.on('tool(demo2)', function(obj){
                var data = obj.data;
                if(obj.event === 'detail'){
                    layer.msg('ID：'+ data.id + ' 的查看操作');
                }else if(obj.event === 'del'){
                        alert("删除")
                }
                layui.close(obj);
            });



        });
    </script>
</div>
</body>
</html>

<style>
    .layui-table-grid-down {
        display: none;
    }
</style>